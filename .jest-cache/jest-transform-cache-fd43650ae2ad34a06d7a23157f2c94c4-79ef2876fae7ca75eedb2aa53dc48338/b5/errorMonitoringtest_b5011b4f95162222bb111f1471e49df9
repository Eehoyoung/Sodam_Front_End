6fc0259601b5a3720e3bf4254a76726e
"use strict";

describe('errorMonitoring', function () {
  beforeEach(function () {
    jest.resetModules();
  });
  test('reports errors and aggregates occurrence counts; records performance metrics', function () {
    jest.isolateModules(function () {
      global.__DEV__ = true;
      var _require = require('../../utils/errorMonitoring'),
        errorMonitor = _require.errorMonitor,
        reportNetworkError = _require.reportNetworkError,
        reportAsyncError = _require.reportAsyncError;
      var reports = errorMonitor.getErrorReports();
      var initialCount = reports.length;
      reportNetworkError('Network glitch');
      reportNetworkError('Network glitch');
      reportAsyncError('Unhandled promise rejection');
      reports = errorMonitor.getErrorReports();
      expect(reports.length).toBeGreaterThanOrEqual(initialCount + 2);
      var networkReport = reports.find(function (r) {
        return r.message.includes('Network glitch');
      });
      expect(networkReport).toBeTruthy();
      expect(networkReport == null ? void 0 : networkReport.occurrenceCount).toBeGreaterThanOrEqual(2);
      expect(networkReport == null ? void 0 : networkReport.resolved).toBe(false);
      errorMonitor.recordPerformanceMetric('metricX', 123);
      var metrics = errorMonitor.getPerformanceMetrics();
      expect(metrics.metricX).toBeDefined();
      expect(metrics.metricX.length).toBeGreaterThan(0);
      expect(metrics.metricX[metrics.metricX.length - 1]).toBe(123);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJqZXN0IiwicmVzZXRNb2R1bGVzIiwidGVzdCIsImlzb2xhdGVNb2R1bGVzIiwiZ2xvYmFsIiwiX19ERVZfXyIsIl9yZXF1aXJlIiwicmVxdWlyZSIsImVycm9yTW9uaXRvciIsInJlcG9ydE5ldHdvcmtFcnJvciIsInJlcG9ydEFzeW5jRXJyb3IiLCJyZXBvcnRzIiwiZ2V0RXJyb3JSZXBvcnRzIiwiaW5pdGlhbENvdW50IiwibGVuZ3RoIiwiZXhwZWN0IiwidG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCIsIm5ldHdvcmtSZXBvcnQiLCJmaW5kIiwiciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsInRvQmVUcnV0aHkiLCJvY2N1cnJlbmNlQ291bnQiLCJyZXNvbHZlZCIsInRvQmUiLCJyZWNvcmRQZXJmb3JtYW5jZU1ldHJpYyIsIm1ldHJpY3MiLCJnZXRQZXJmb3JtYW5jZU1ldHJpY3MiLCJtZXRyaWNYIiwidG9CZURlZmluZWQiLCJ0b0JlR3JlYXRlclRoYW4iXSwic291cmNlcyI6WyJlcnJvck1vbml0b3JpbmcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBUZXN0cyBmb3IgZXJyb3JNb25pdG9yaW5nIHN5c3RlbSAqL1xyXG5cclxuZGVzY3JpYmUoJ2Vycm9yTW9uaXRvcmluZycsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ3JlcG9ydHMgZXJyb3JzIGFuZCBhZ2dyZWdhdGVzIG9jY3VycmVuY2UgY291bnRzOyByZWNvcmRzIHBlcmZvcm1hbmNlIG1ldHJpY3MnLCAoKSA9PiB7XHJcbiAgICBqZXN0Lmlzb2xhdGVNb2R1bGVzKCgpID0+IHtcclxuICAgICAgLy8gRW5zdXJlIF9fREVWX18gdHJ1ZSBmb3IgZW5hYmxpbmcgbW9uaXRvclxyXG4gICAgICAoZ2xvYmFsIGFzIGFueSkuX19ERVZfXyA9IHRydWU7XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yTW9uaXRvciwgcmVwb3J0TmV0d29ya0Vycm9yLCByZXBvcnRBc3luY0Vycm9yIH0gPSByZXF1aXJlKCcuLi8uLi91dGlscy9lcnJvck1vbml0b3JpbmcnKTtcclxuXHJcbiAgICAgIC8vIEluaXRpYWwgcmVwb3J0c1xyXG4gICAgICBsZXQgcmVwb3J0cyA9IGVycm9yTW9uaXRvci5nZXRFcnJvclJlcG9ydHMoKTtcclxuICAgICAgY29uc3QgaW5pdGlhbENvdW50ID0gcmVwb3J0cy5sZW5ndGg7XHJcblxyXG4gICAgICAvLyBSZXBvcnQgYSBuZXR3b3JrIGVycm9yIHR3aWNlXHJcbiAgICAgIHJlcG9ydE5ldHdvcmtFcnJvcignTmV0d29yayBnbGl0Y2gnKTtcclxuICAgICAgcmVwb3J0TmV0d29ya0Vycm9yKCdOZXR3b3JrIGdsaXRjaCcpO1xyXG5cclxuICAgICAgLy8gUmVwb3J0IGFuIGFzeW5jIGVycm9yIG9uY2VcclxuICAgICAgcmVwb3J0QXN5bmNFcnJvcignVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uJyk7XHJcblxyXG4gICAgICByZXBvcnRzID0gZXJyb3JNb25pdG9yLmdldEVycm9yUmVwb3J0cygpO1xyXG4gICAgICBleHBlY3QocmVwb3J0cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoaW5pdGlhbENvdW50ICsgMik7XHJcblxyXG4gICAgICBjb25zdCBuZXR3b3JrUmVwb3J0ID0gcmVwb3J0cy5maW5kKHIgPT4gci5tZXNzYWdlLmluY2x1ZGVzKCdOZXR3b3JrIGdsaXRjaCcpKTtcclxuICAgICAgZXhwZWN0KG5ldHdvcmtSZXBvcnQpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgZXhwZWN0KG5ldHdvcmtSZXBvcnQ/Lm9jY3VycmVuY2VDb3VudCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgyKTtcclxuICAgICAgZXhwZWN0KG5ldHdvcmtSZXBvcnQ/LnJlc29sdmVkKS50b0JlKGZhbHNlKTtcclxuXHJcbiAgICAgIC8vIFJlY29yZCBhIHBlcmZvcm1hbmNlIG1ldHJpYyBhbmQgY2hlY2sgcmV0cmlldmFsXHJcbiAgICAgIGVycm9yTW9uaXRvci5yZWNvcmRQZXJmb3JtYW5jZU1ldHJpYygnbWV0cmljWCcsIDEyMyk7XHJcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBlcnJvck1vbml0b3IuZ2V0UGVyZm9ybWFuY2VNZXRyaWNzKCk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLm1ldHJpY1gpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLm1ldHJpY1gubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICAgIGV4cGVjdChtZXRyaWNzLm1ldHJpY1hbbWV0cmljcy5tZXRyaWNYLmxlbmd0aCAtIDFdKS50b0JlKDEyMyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFFQUEsUUFBUSxDQUFDLGlCQUFpQixFQUFFLFlBQU07RUFDaENDLFVBQVUsQ0FBQyxZQUFNO0lBQ2ZDLElBQUksQ0FBQ0MsWUFBWSxDQUFDLENBQUM7RUFDckIsQ0FBQyxDQUFDO0VBRUZDLElBQUksQ0FBQyw4RUFBOEUsRUFBRSxZQUFNO0lBQ3pGRixJQUFJLENBQUNHLGNBQWMsQ0FBQyxZQUFNO01BRXZCQyxNQUFNLENBQVNDLE9BQU8sR0FBRyxJQUFJO01BRTlCLElBQUFDLFFBQUEsR0FBK0RDLE9BQU8sQ0FBQyw2QkFBNkIsQ0FBQztRQUE3RkMsWUFBWSxHQUFBRixRQUFBLENBQVpFLFlBQVk7UUFBRUMsa0JBQWtCLEdBQUFILFFBQUEsQ0FBbEJHLGtCQUFrQjtRQUFFQyxnQkFBZ0IsR0FBQUosUUFBQSxDQUFoQkksZ0JBQWdCO01BRzFELElBQUlDLE9BQU8sR0FBR0gsWUFBWSxDQUFDSSxlQUFlLENBQUMsQ0FBQztNQUM1QyxJQUFNQyxZQUFZLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTTtNQUduQ0wsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUM7TUFDcENBLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDO01BR3BDQyxnQkFBZ0IsQ0FBQyw2QkFBNkIsQ0FBQztNQUUvQ0MsT0FBTyxHQUFHSCxZQUFZLENBQUNJLGVBQWUsQ0FBQyxDQUFDO01BQ3hDRyxNQUFNLENBQUNKLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUNFLHNCQUFzQixDQUFDSCxZQUFZLEdBQUcsQ0FBQyxDQUFDO01BRS9ELElBQU1JLGFBQWEsR0FBR04sT0FBTyxDQUFDTyxJQUFJLENBQUMsVUFBQUMsQ0FBQztRQUFBLE9BQUlBLENBQUMsQ0FBQ0MsT0FBTyxDQUFDQyxRQUFRLENBQUMsZ0JBQWdCLENBQUM7TUFBQSxFQUFDO01BQzdFTixNQUFNLENBQUNFLGFBQWEsQ0FBQyxDQUFDSyxVQUFVLENBQUMsQ0FBQztNQUNsQ1AsTUFBTSxDQUFDRSxhQUFhLG9CQUFiQSxhQUFhLENBQUVNLGVBQWUsQ0FBQyxDQUFDUCxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7TUFDaEVELE1BQU0sQ0FBQ0UsYUFBYSxvQkFBYkEsYUFBYSxDQUFFTyxRQUFRLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEtBQUssQ0FBQztNQUczQ2pCLFlBQVksQ0FBQ2tCLHVCQUF1QixDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUM7TUFDcEQsSUFBTUMsT0FBTyxHQUFHbkIsWUFBWSxDQUFDb0IscUJBQXFCLENBQUMsQ0FBQztNQUNwRGIsTUFBTSxDQUFDWSxPQUFPLENBQUNFLE9BQU8sQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUNyQ2YsTUFBTSxDQUFDWSxPQUFPLENBQUNFLE9BQU8sQ0FBQ2YsTUFBTSxDQUFDLENBQUNpQixlQUFlLENBQUMsQ0FBQyxDQUFDO01BQ2pEaEIsTUFBTSxDQUFDWSxPQUFPLENBQUNFLE9BQU8sQ0FBQ0YsT0FBTyxDQUFDRSxPQUFPLENBQUNmLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDVyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQy9ELENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==